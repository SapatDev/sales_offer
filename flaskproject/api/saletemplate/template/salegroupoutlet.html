{% extends 'base.html' %}


{% block content %}
<div class="main-panel">
  <div class="content-wrapper">

    <div class="col-lg-12 stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Table with contextual classes</h4>
            <!-- <p class="card-description">
              Add class <code>.table-{color}</code>
            </p> -->
            <div class="table-responsive pt-3">
              <table class="table table-striped">
                <thead>
                    <tr>
                        

                       <th>outletId</th>
                       <th>Beatname</th>
                       <th>OutletName</th>
                       {% for type_id in unique_type %}
                       <th>{{type_id}}</th>
                       {% endfor %}
                     
                     
                       
                        
                    </tr>
                   
    
                </thead>
               
                    <tbody>
                        <!--  total sum in type_Id realetd -->
                        {% set coupon_sums = {} %} 
                        {% for coupon_typeId in unique_coupon_type %}
                            {% set coupon_sums = coupon_sums.update({coupon_typeId: 0}) %}
                        {% endfor %}
<!-- Dictionary to hold sums for each coupon_typeId -->

                        {% for outlet in outletId %}
                        <tr>
                            <td>{{outlet}}</td>

                            <td>
                                {% set beatname = dict_list|selectattr('outletId', 'eq',outlet)|map(attribute='beatname')|list|first %}
                                {{ beatname if beatname is defined else '' }}
                            </td>

                                <!-- {{unique_beatname}}</td> -->
                            <td>
                                {% set outletName = dict_list|selectattr('outletId', 'eq',outlet)|map(attribute='outletName')|list|first %}
                                {{ outletName if outletName is defined else '' }}
                                <!-- {{unique_outletName}} -->
                            </td>

                            {% set scheme_counts = {} %}
                            
                            {% for item in dict_list if item['outletId'] == outlet %}
                            {% set _ = scheme_counts.update({item['coupon_type']: item['scheme_count']}) %}
                            {% endfor %}
                            {% for type_id in unique_type %}
                            {% if type_id in scheme_counts %} 
                            <td>{{ scheme_counts[type_id] }}</td>
                            {% else %}
                            <td>0</td>
                            {% endif %}
                        <!--  total sum in type_Id realetd -->
                            {% set coupon_sums = coupon_sums.update({type_id: (coupon_sums[type_id]|default(0)) + (scheme_counts[type_id]|default(0))}) %}
                        <!--  total sum in type_Id realetd -->
                            {% endfor %}

                        </tr>
                        {% endfor %}

                        <!--  total sum in type_Id realetd -->

                         <tr>
                        <td></td> 
                        <td></td> 
                        <td><h6>Grand-Total</h6></td> 
                        {% for type_id in unique_type %}
                            <td>{{ coupon_sums[type_id] }}</td>
                        {% endfor %}
                        <!--  total sum in type_Id realetd -->
                    </tr>
                      
                      
                    </tbody> 
              </table>
            </div>
          </div>
        </div>
      </div>

    
  </div>
 
</div>
{% endblock %}