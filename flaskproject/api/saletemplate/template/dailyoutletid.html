{% extends 'base.html' %}


{% block content %}
<div class="main-panel">
  <div class="content-wrapper">


      <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Employee outletId {{payerId}}</h4>

            <div style="display: flex;align-items: center;gap: 5px;">
                <button class="button-62" role="button"  onclick="tableToExcel()">Download as Excel</button>
            </div>

            <!-- <form action="{{ url_for('targetsales', payerId=payerId) }}" method="GET">
                <label for="month">Start Date:</label>
                <input type="date" id="month" name="month">
                <label for="year">End Date:</label>
                <input type="date" id="year" name="year">
                <button type="submit">Search</button>
            </form> -->
        
                       
            <div class="table-responsive pt-3">
                <table class="table table-striped" id="datatablesSimple">
                    <thead>
                        <tr>
                           
                            <th>Gradecode</th>
                            <th>Salesgroup</th>
                            <th>Targetsale</th>
                            <th>Monthsale</th>
                            <th>LYsales</th>
                            <th>TGTGap</th>
                            <th>Achive%</th>
                            <th>Progress</th>
                           
                            
                     
                        
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in dict_list %}

                        <tr>
                            
                            <td>{{ item['gradecode'] }}</td>
                            <td>{{ item['salesgroup']}}</td>
                            <td>{{ (item['Total Target Sale']|float)|int }}</td>
                            <td>{{ (item['Total Month Sale']|float)|int }}</td>
                            <td>{{ (item['LY_Sales']|float)|int }}</td>
                            <td>{{ (item['Target Gap']|float)|int}}</td>
                            <td>{{ '%.1f'|format(item['Achievement Percentage'])}}%</td> 
                            <td>
                                <div class="progress">
                                    <div class="progress-bar {% if item['Achievement Percentage'] >= 100 %}bg-danger{% else %}bg-success{% endif %}" role="progressbar" style="width: {{ item['Achievement Percentage'] }}%;" aria-valuenow="{{ item['Achievement Percentage'] }}" aria-valuemin="0" aria-valuemax="100">
                                        
                                    </div>
                                </div>
                            </td>
                            <!-- <td>{{ '%.1f'|format(item['Achievement Percentage'])}}%</td> -->
                            
                           
                          
                            
                            
                        </tr>
                    {% endfor %}

                    <tr>
                        <td>Total:</td>
                        <td></td>
                        <td>{{ total_tgt_sale|int }}</td>
                        <td>{{ total_month_sale|int }}</td>
                        <td>{{ LY_Sales|int }}</td>
                        <td>{{ total_tgt_gap|int }}</td>
                        <td>{{ '%.2f'|format(average_achievement_percentage) }}%</td>
                    </tr>
             
                    </tbody>
                </table>
            </div>




          </div>
        </div>
      </div>

    
  </div>
 
</div>



<script>

    function tableToExcel() {
            const table = document.getElementById('datatablesSimple');
            const wb = XLSX.utils.table_to_book(table, { sheet: 'SheetJS' });
            const wbout = XLSX.write(wb, { bookType: 'xlsx', bookSST: true, type: 'binary' });
    
            function s2ab(s) {
                const buf = new ArrayBuffer(s.length);
                const view = new Uint8Array(buf);
                for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                return buf;
            }
            saveAs(new Blob([s2ab(wbout)], { type: 'application/octet-stream' }), 'sales data.xlsx');
        }
    
      
      </script>
{% endblock %}