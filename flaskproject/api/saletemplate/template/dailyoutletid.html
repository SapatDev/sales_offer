{% extends 'base.html' %}


{% block content %}

<div class="main-panel">
  <div class="content-wrapper">


      <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">{{stokist_name}} ({{payerId}})</h4>

            <div style="display: flex; justify-content: flex-end;  margin-bottom: 5px;">
              <button class="btn btn-sm btn-secondary" role="button"  onclick="tableToExcel()">Download as Excel</button>
           </div>
  
            <div style="display: flex; margin-bottom: 15px;">
                <h4>From: {{from_month}}-{{from_year}} To: {{end_month}}-{{end_year}}</h4>
            </div>

            <div class="num_rows">
                <div class="form-group">
                  <!--		Show Numbers Of Rows 		-->
                  <select class="form-control" name="state" id="maxRows">
                    
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="70">70</option>
                    <option value="100">100</option>
                    <option value="5000">Show ALL Rows</option>
                  </select>
    
                </div>
              </div>
    
              <div class="tb_search">
                <input type="text" id="search_input_all" onkeyup="FilterkeyWord_all_table()" class="form-control"
                placeholder="Search Stock Data" aria-label="Search Stock Data">
              </div>

            <!-- <form action="{{ url_for('targetsales', payerId=payerId) }}" method="GET">
                <label for="month">Start Date:</label>
                <input type="date" id="month" name="month">
                <label for="year">End Date:</label>
                <input type="date" id="year" name="year">
                <button type="submit">Search</button>
            </form> -->
            <!-- <form action="{{ url_for('targetsales', payerId=payerId) }}" method="GET">
                <label for="from_month">From Month:</label>
                <input type="number" id="from_month" name="from_month" value="{{ from_month }}">
                <label for="from_year">From Year:</label>
                <input type="number" id="from_year" name="from_year" value="{{ from_year }}">
                <label for="month">Month:</label>
                <input type="number" id="end_month" name="end_month" value="{{ end_month }}">
                <label for="year">Year:</label>
                <input type="number" id="end_year" name="end_year" value="{{ end_year }}">
                <button type="submit">Search</button>
            </form> -->
        
                       
            <div class="table-responsive pt-3">
                <table class="table table-striped" id="datatablesSimple">
                    <thead>
                        <tr>
                           
                            <th>Gradecode</th>
                            <th>Salesgroup</th>
                            <th>Targetsale</th>
                            <th>Monthsale</th>
                            <th>LYsales</th>
                            <th>TGTGap</th>
                            <th>Achive%</th>
                            <th>Progress</th>
                           
                            
                     
                        
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in dict_list %}

                        <tr>
                            
                            <td>{{ item['gradecode'] }}</td>
                            <td>{{ item['salesgroup']}}</td>
                            <td>{{ (item['Total Target Sale']|float)|int }}</td>
                            <td>{{ (item['Total Month Sale']|float)|int }}</td>
                            <td>{{ (item['LY_Sales']|float)|int }}</td>
                            <td>{{ (item['Target Gap']|float)|int}}</td>
                            <td>{{ '%.1f'|format(item['Achievement Percentage'])}}%</td> 
                            <td>
                                <div class="progress">
                                    <div class="progress-bar {% if item['Achievement Percentage'] >= 100 %}bg-danger{% else %}bg-success{% endif %}" role="progressbar" style="width: {{ item['Achievement Percentage'] }}%;" aria-valuenow="{{ item['Achievement Percentage'] }}" aria-valuemin="0" aria-valuemax="100">
                                        
                                    </div>
                                </div>
                            </td>
                            <!-- <td>{{ '%.1f'|format(item['Achievement Percentage'])}}%</td> -->
                            
                           
                          
                            
                            
                        </tr>
                    {% endfor %}

                    <tr>
                        <td>Total:</td>
                        <td></td>
                        <td>{{ total_tgt_sale|int }}</td>
                        <td>{{ total_month_sale|int }}</td>
                        <td>{{ LY_Sales|int }}</td>
                        <td>{{ total_tgt_gap|int }}</td>
                        <td>{{ '%.2f'|format(average_achievement_percentage) }}%</td>
                    </tr>
             
                    </tbody>
                </table>
            </div>




          </div>
        </div>
      </div>

    
  </div>
 
</div>



<script>

    function tableToExcel() {
            const table = document.getElementById('datatablesSimple');
            const wb = XLSX.utils.table_to_book(table, { sheet: 'SheetJS' });
            const wbout = XLSX.write(wb, { bookType: 'xlsx', bookSST: true, type: 'binary' });
    
            function s2ab(s) {
                const buf = new ArrayBuffer(s.length);
                const view = new Uint8Array(buf);
                for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                return buf;
            }
            saveAs(new Blob([s2ab(wbout)], { type: 'application/octet-stream' }), 'sales data.xlsx');
        }
    
      
      </script>
{% endblock %}